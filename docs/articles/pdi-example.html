<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generating phenotypic decline indexes using the pdi package • pdi</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Generating phenotypic decline indexes using the pdi package">
<meta property="og:description" content="pdi">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pdi</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/pdi-example.html">Generating phenotypic decline indexes using the pdi package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jasenfinch/pdi/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="pdi-example_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Generating phenotypic decline indexes using the pdi package</h1>
                        <h4 class="author">Jasen Finch</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jasenfinch/pdi/blob/master/vignettes/pdi-example.Rmd"><code>vignettes/pdi-example.Rmd</code></a></small>
      <div class="hidden name"><code>pdi-example.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Oak declines are complex disease syndromes that consist of many visual indicators that include aspects of tree size, crown condition and trunk condition <span class="citation">(Denman and Webber 2009; Denman et al. 2014)</span>. This can cause difficulty in the manual classification of symptomatic and non-symptomatic trees from what is in reality a broad spectrum of oak tree health condition.</p>
<p>Two oak decline indexes have been developed to quantitatively describe and differentiate oak decline syndromes in <em>Quercus robur</em>. These include:</p>
<ul>
<li><p><strong>Phenotypic Decline Index (PDI)</strong> - a measure of overall decline severity, scoring trees between 0 and 1. More severely declining oak trees having a score closer to 1.</p></li>
<li><p><strong>Decline Acuteness Index (DAI)</strong> - a measure to differentiate between Chronic Oak Decline (COD) and Acute Oak Decline with a score between -1 and 1. Acutely declining trees having a score closer to 1 and chronically declining trees having a score closer to -1.</p></li>
</ul>
<p>For more information on the methodology behind generating these decline indexes, see the article:</p>
<p><a href="https://doi.org/10.1016/j.foreco.2021.118948">Finch, J.P., Brown, N., Beckmann, M., Denman, S. and Draper, J., 2021. Index measures for oak decline severity using phenotypic descriptors. Forest Ecology and Management, 485, p.118948.</a></p>
<p>This vignette will provide an example framework of how to generate these decline indexes based on the machine learning algorithm random forest, using an example set of phenotypic descriptors.</p>
<p>To begin, load the package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jasenfinch.github.io/pdi">pdi</a></span><span class="op">)</span></code></pre></div>
<p>The following example example will also make use the dplyr package for data manipulation, ggplot2 for visualisation and the pipe (<code><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></code>) from the magrittr package. The additionally required packages can be loaded using:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="example-data" class="section level2">
<h2 class="hasAnchor">
<a href="#example-data" class="anchor"></a>Example Data</h2>
<p>For this example, we will be using phenotypic data provided within the package. This consists of data collected from two woodlands each with 20 oak trees surveyed. The trees were manually assigned an oak decline status with 10 decline symptomatic and 10 decline non-symptomatic trees at each site.</p>
<p>The file paths for the example data can be retrieved with the following:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">'phenotypeDataCollectionSheets'</span>,
              package <span class="op">=</span> <span class="st">'pdi'</span><span class="op">)</span>,
  full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </code></pre></div>
<p>For collecting further data, a clean copy of the phenotyping data collection sheet template can be exported using:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/phenotypingTemplate.html">phenotypingTemplate</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">'.'</span><span class="op">)</span></code></pre></div>
</div>
<div id="index-generation" class="section level2">
<h2 class="hasAnchor">
<a href="#index-generation" class="anchor"></a>Index generation</h2>
<div id="data-preparation" class="section level3">
<h3 class="hasAnchor">
<a href="#data-preparation" class="anchor"></a>Data preparation</h3>
<p>There are several steps involved the initial preparation of the example phenotypic data collection sheets.</p>
<p>Firstly, the sheets can be parsed to give a list object containing the raw data for each site using:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">files</span>,<span class="va">readPhenotypeSheet</span><span class="op">)</span></code></pre></div>
<p>These can then be assembled into a single tibble with the following:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">d</span>,<span class="va">preparePhenotypeData</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>As shown below, this provides a tibble containing 36 phenotypic descriptors for the 40 trees across the two sites.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 40 x 36</span>
<span class="co">#&gt;    Location    ID `Agrilus exit h… `Branch epicorm… `Crown contact …</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;dbl&gt;            &lt;dbl&gt; &lt;chr&gt;                       &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Site 1       1                0 2                              80</span>
<span class="co">#&gt;  2 Site 1       2                0 2                              55</span>
<span class="co">#&gt;  3 Site 1       3                0 3                              50</span>
<span class="co">#&gt;  4 Site 1       4                0 1                              10</span>
<span class="co">#&gt;  5 Site 1       5                0 1                              55</span>
<span class="co">#&gt;  6 Site 1       6                0 2                              15</span>
<span class="co">#&gt;  7 Site 1       7                0 2                              50</span>
<span class="co">#&gt;  8 Site 1       8                0 3                               0</span>
<span class="co">#&gt;  9 Site 1       9                0 3                              10</span>
<span class="co">#&gt; 10 Site 1      10                0 1                              15</span>
<span class="co">#&gt; # … with 30 more rows, and 31 more variables: `Crown transparency (%)` &lt;dbl&gt;,</span>
<span class="co">#&gt; #   `Crown fruiting bodies` &lt;chr&gt;, `Crown mildew` &lt;chr&gt;, `Diameter at breast</span>
<span class="co">#&gt; #   height (m)` &lt;dbl&gt;, `Dieback location` &lt;chr&gt;, `Dieback type` &lt;chr&gt;,</span>
<span class="co">#&gt; #   GPS &lt;chr&gt;, `Ground level fruiting bodies` &lt;chr&gt;, `Insect</span>
<span class="co">#&gt; #   defoliation` &lt;chr&gt;, `Insect defoliation type` &lt;chr&gt;, `Lower crown height</span>
<span class="co">#&gt; #   (m)` &lt;dbl&gt;, `Missing crown (%)` &lt;dbl&gt;, `Oval shaped exit holes` &lt;chr&gt;,</span>
<span class="co">#&gt; #   `Pruning / branch loss` &lt;chr&gt;, `Small circular shaped exit holes` &lt;chr&gt;,</span>
<span class="co">#&gt; #   `Social class` &lt;chr&gt;, `Stem fruiting bodies` &lt;chr&gt;, `Stem</span>
<span class="co">#&gt; #   epicormics` &lt;chr&gt;, Status &lt;chr&gt;, `Timber height (m)` &lt;dbl&gt;, `Total height</span>
<span class="co">#&gt; #   (m)` &lt;dbl&gt;, `Tree No` &lt;chr&gt;, `Dead stem tissue` &lt;chr&gt;, `Crown radius</span>
<span class="co">#&gt; #   (m)` &lt;dbl&gt;, `Canopy closure` &lt;chr&gt;, `Active bleeds` &lt;dbl&gt;, `Black</span>
<span class="co">#&gt; #   staining` &lt;dbl&gt;, `Calloused wound` &lt;dbl&gt;, `Active bleed length (mm)` &lt;dbl&gt;,</span>
<span class="co">#&gt; #   `Black staining length (mm)` &lt;dbl&gt;, `Calloused wound length (mm)` &lt;dbl&gt;</span></code></pre></div>
</div>
<div id="tree-size-descriptor-adjustment" class="section level3">
<h3 class="hasAnchor">
<a href="#tree-size-descriptor-adjustment" class="anchor"></a>Tree size descriptor adjustment</h3>
<p>To account for potential differences in the age/size of tree between sites, an adjustment can be applied to standardised these descriptors to ensure that they are comparable between the sites.</p>
<p>The tree size descriptors in the example data set include:</p>
<ul>
<li>Diameter at breast height (m)</li>
<li>Lower crown height (m)</li>
<li>Timber height (m)</li>
<li>Total height (m)</li>
<li>Crown radius (m)</li>
</ul>
<p>As can be seen in the plot below, there is a difference in the diameter at breast height between the sites; Site 2 having trees with greater diameter than Site 1.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">p</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Location</span>,y <span class="op">=</span> <span class="va">`Diameter at breast height (m)`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="pdi-example_files/figure-html/DBH_site_plot-1.png" width="700" style="display: block; margin: auto;"></p>
<p>The adjustment to the tree size descriptors can be applied using the following. For each descriptor, this will adjust the site means to the overall mean, removing inter-site variance while maintaining intra-site variance.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/siteAdjustment.html">siteAdjustment</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></code></pre></div>
<p>The plot below shows the effect of the adjustment of the diameter at breast height with the difference between the sites removed.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">sa</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Location</span>,y <span class="op">=</span> <span class="va">`Diameter at breast height (m)`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="pdi-example_files/figure-html/DBH_site_adjusted_plot-1.png" width="700" style="display: block; margin: auto;"></p>
<p>The adjustment factors for each descriptor at each site can be returned using the following:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sa_factors</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/siteAdjustmentFactors.html">siteAdjustmentFactors</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>
<span class="va">sa_factors</span>
<span class="co">#&gt; # A tibble: 10 x 4</span>
<span class="co">#&gt;    Descriptor                    Location   Mean Adjustment</span>
<span class="co">#&gt;    &lt;chr&gt;                         &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Crown radius (m)              Site 1    4.01      -0.887</span>
<span class="co">#&gt;  2 Crown radius (m)              Site 2    5.78       0.887</span>
<span class="co">#&gt;  3 Diameter at breast height (m) Site 1    0.364     -0.147</span>
<span class="co">#&gt;  4 Diameter at breast height (m) Site 2    0.658      0.147</span>
<span class="co">#&gt;  5 Lower crown height (m)        Site 1   11.0        1.47 </span>
<span class="co">#&gt;  6 Lower crown height (m)        Site 2    8.06      -1.47 </span>
<span class="co">#&gt;  7 Timber height (m)             Site 1    8.04      -2.14 </span>
<span class="co">#&gt;  8 Timber height (m)             Site 2   12.3        2.14 </span>
<span class="co">#&gt;  9 Total height (m)              Site 1   19.2       -0.805</span>
<span class="co">#&gt; 10 Total height (m)              Site 2   20.8        0.805</span></code></pre></div>
</div>
<div id="additional-descriptors-calculation" class="section level3">
<h3 class="hasAnchor">
<a href="#additional-descriptors-calculation" class="anchor"></a>Additional descriptors calculation</h3>
<p>Additional composite descriptors can be calculated to account for the three dimensional tree attributes and covariate nature of certain descriptors.</p>
<p>The additional descriptors provided by pdi include:</p>
<ul>
<li>
<code>liveCrownRatio</code> - Live crown ratio (%)</li>
<li>
<code>crownCondition</code> - Crown condition (%)</li>
<li>
<code>crownVolume</code> - Crown volume (m<sup>3</sup>)</li>
<li>
<code>bleedPrevalence</code> - Bleed prevalence (%)</li>
<li>
<code>agrilusExitHoleDensity</code> - Agrilus exit hole density (m<sup>-2</sup>)</li>
</ul>
<p>These descriptors can be calculated for the example data using:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">sa</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>`Live crown ratio (%)` <span class="op">=</span> <span class="fu"><a href="../reference/liveCrownRatio.html">liveCrownRatio</a></span><span class="op">(</span><span class="va">`Total height (m)`</span>,
                                                 <span class="va">`Lower crown height (m)`</span><span class="op">)</span>,
         `Crown condition (%)` <span class="op">=</span> <span class="fu"><a href="../reference/crownCondition.html">crownCondition</a></span><span class="op">(</span><span class="va">`Missing crown (%)`</span>,
                                                <span class="va">`Crown transparency (%)`</span><span class="op">)</span>,
         `Crown volume (m^3)` <span class="op">=</span> <span class="fu"><a href="../reference/crownVolume.html">crownVolume</a></span><span class="op">(</span><span class="va">`Crown radius (m)`</span>,
                                            <span class="va">`Total height (m)`</span>,
                                            <span class="va">`Lower crown height (m)`</span>,
                                            <span class="va">`Crown condition (%)`</span><span class="op">)</span>,
         `Bleed prevalence (%)` <span class="op">=</span> <span class="fu"><a href="../reference/bleedPrevalence.html">bleedPrevalence</a></span><span class="op">(</span><span class="va">`Active bleed length (mm)`</span>,
                                                  <span class="va">`Active bleeds`</span>,
                                                  <span class="va">`Black staining length (mm)`</span>,
                                                  <span class="va">`Black staining`</span>,
                                                  <span class="va">`Diameter at breast height (m)`</span><span class="op">)</span>,
         `Agrilus exit hole density (m^-2)` <span class="op">=</span> <span class="fu"><a href="../reference/agrilusExitHoleDensity.html">agrilusExitHoleDensity</a></span><span class="op">(</span><span class="va">`Agrilus exit holes`</span>,
                                                                     <span class="va">`Diameter at breast height (m)`</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
</div>
<div id="random-forest-model-fitting" class="section level3">
<h3 class="hasAnchor">
<a href="#random-forest-model-fitting" class="anchor"></a>Random forest model fitting</h3>
<p>Prior to index calculation, random forest models need to be fitted to the data, from which the indexes are calculated.</p>
<p>The data first needs to be prepared for random forest analysis:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeAnalysisTable.html">makeAnalysisTable</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span></code></pre></div>
<p>Then random forest can then be performed using:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rf.html">rf</a></span><span class="op">(</span><span class="va">t</span>,cls <span class="op">=</span> <span class="cn">NULL</span>,nreps <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<p>Here we are using unsupervised analysis (<code>cls = NULL</code>) as this data provides clear differentiation in decline status (see Index calculation section). A supervised analysis could instead be used for data sets where this distinction is not so clear and unsupervised methods are not appropriate.</p>
</div>
<div id="index-calculation" class="section level3">
<h3 class="hasAnchor">
<a href="#index-calculation" class="anchor"></a>Index calculation</h3>
<p>The following will calculate the decline indexes based on the proximity values calculated from the random forest models generated in the section above.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">DIs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcDIs.html">calcDIs</a></span><span class="op">(</span><span class="va">m</span>,DAI <span class="op">=</span> <span class="cn">FALSE</span>,invertPDI <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">a</span> <span class="op">%&gt;%</span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Location</span>,<span class="va">ID</span>,<span class="va">Status</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Here, only the PDI is calculated due to the low number of observations in the example data set. We have also chosen not to invert the calculated PDI index scale in this example. In other cases, inversion may be required to ensure the scale is orientated correctly.</p>
<p>The box plots of the calculated indexes are shown below. It can be seen that the decline statuses are clearly differentiated at Site 1 and less so at Site 2 with symptomatic trees having PDI values closer to 1.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">DIs</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Status</span>,y <span class="op">=</span> <span class="va">PDI</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Location</span><span class="op">)</span></code></pre></div>
<p><img src="pdi-example_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;"></p>
</div>
<div id="descriptor-contributions" class="section level3">
<h3 class="hasAnchor">
<a href="#descriptor-contributions" class="anchor"></a>Descriptor contributions</h3>
<p>Now the decline indexes have been calculated, we next need to understand the relative contributions of the descriptors to the indexes. These can be calculated using the mean decrease in accuracy variable importance metric from the fitted random forest models. These importance scores can be retrieved using the following:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">descriptor_contributions</span> <span class="op">&lt;-</span> <span class="va">m</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/descriptorContributions.html">descriptorContributions</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>The relative descriptor contributions can then be plotted using the following code, with the higher contributing descriptors at the top of the y-axis.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">descriptor_contributions</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">MeanDecreaseAccuracy</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Descriptor <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Descriptor</span>,levels <span class="op">=</span> <span class="va">Descriptor</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">MeanDecreaseAccuracy</span>,y <span class="op">=</span> <span class="va">Descriptor</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="pdi-example_files/figure-html/contributions_plot-1.png" width="480" style="display: block; margin: auto;"></p>
<p>As can be seen in the plot above, the crown volume descriptor was ranked highest and therefore contributed most to the calculated decline indexes. The plot blow shows crown volume plotted against the calculated PDI values for each tree. It can be seen that the trees with lower PDI values (healthier) also have greater crown volumes which is what would be expected.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">DIs</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span><span class="va">a</span> <span class="op">%&gt;%</span>
              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">`Crown volume (m^3)`</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">PDI</span>,y <span class="op">=</span> <span class="va">`Crown volume (m^3)`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="pdi-example_files/figure-html/crown_volume_plot-1.png" width="700" style="display: block; margin: auto;"></p>
<p>It is important at this stage to carefully assess the descriptor contributions to, and associations with, the calculated decline indexes to ensure they suitably describe the decline syndromes on which they are based. Where this has not been achieved, solutions could include using supervised random forest models instead of the unsupervised approach used here or the addition/removal of phenotypic descriptors from the models.</p>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-denman2014" class="csl-entry">
Denman, Sandra, Nathan Brown, Susan Kirk, Mike Jeger, and Joan Webber. 2014. <span>“A Description of the Symptoms of Acute Oak Decline in Britain and a Comparative Review on Causes of Similar Disorders on Oak in Europe.”</span> <em>Forestry: An International Journal of Forest Research</em> 87 (4): 535–51.
</div>
<div id="ref-denman2009" class="csl-entry">
Denman, Sandra, and Joan Webber. 2009. <span>“Oak Declines: New Definitions and New Episodes in Britain.”</span> <em>Quarterly Journal of Forestry</em> 103 (4): 285–90.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jasen Finch.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
